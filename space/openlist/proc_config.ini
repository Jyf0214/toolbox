[supervisord]
nodaemon=true
logfile=/tmp/manager.log
pidfile=/tmp/manager.pid
user=appuser
loglevel=critical

[program:main_app] ; (Openlist)
# 关键改动：使用 envsubst 读取模板，替换变量，生成最终配置，然后启动服务
command=bash -c 'exec openlist server'
directory=/home/appuser
autostart=true
autorestart=true
user=appuser
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0

[program:static_server] ; (静态文件服务)
command=python3 -m http.server 7860 --directory /app/static
directory=/app/static
autostart=true
autorestart=true
user=appuser
redirect_stderr=true
stdout_logfile=/dev/null
stdout_logfile_maxbytes=0

[program:tunnel_client] ; (frpc)
command=/opt/tunnel/frpc -u %(ENV_FRPC_SECRET_KEY)s -p 201696
directory=/opt/tunnel
autostart=true
autorestart=true
user=appuser
redirect_stderr=true
stdout_logfile=/dev/null
stdout_logfile_maxbytes=0
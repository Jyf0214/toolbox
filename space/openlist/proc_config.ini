[supervisord]
nodaemon=true
logfile=/tmp/manager.log
pidfile=/tmp/manager.pid
user=appuser
loglevel=critical

[program:main_app] ; (Openlist) - 日志保持可见
# --- 关键改动：使用 printf 代替 echo 来保证引号被完整写入 ---
command=bash -c 'if [ -n "%(ENV_OPLIST_CONFIG)s" ]; then printf "%s" "%(ENV_OPLIST_CONFIG)s" > /home/appuser/data/config.json; fi && exec openlist server'
directory=/home/appuser
autostart=true
autorestart=true
user=appuser
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0

[program:static_server] ; (静态文件服务) - 日志将被隐藏
command=python3 -m http.server 7860 --directory /app/static
directory=/app/static
autostart=true
autorestart=true
user=appuser
redirect_stderr=true
stdout_logfile=/dev/null
stdout_logfile_maxbytes=0

[program:tunnel_client] ; (frpc) - 日志将被隐藏
command=/opt/tunnel/frpc -u %(ENV_FRPC_SECRET_KEY)s -p 201696
directory=/opt/tunnel
autostart=true
autorestart=true
user=appuser
redirect_stderr=true
stdout_logfile=/dev/null
stdout_logfile_maxbytes=0
[supervisord]
nodaemon=true
logfile=/var/log/service_manager/manager.log
pidfile=/var/run/manager.pid
user=appuser
loglevel=critical

[program:main_app] ; (Openlist) - 日志保持可见
# --- 关键改动在这里 ---
# 这个命令首先检查 OPLIST_CONFIG 变量是否存在，如果存在就写入文件，然后用 exec 启动 openlist
command=bash -c 'if [ -n "$$OPLIST_CONFIG" ]; then echo "$$OPLIST_CONFIG" > /home/appuser/data/config.json; fi && exec openlist server'
directory=/home/appuser
autostart=true
autorestart=true
user=appuser
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0

[program:static_server] ; (静态文件服务) - 日日志将被隐藏
command=python3 -m http.server 7860 --directory /app/static
directory=/app/static
autostart=true
autorestart=true
user=appuser
redirect_stderr=true
stdout_logfile=/dev/null
stdout_logfile_maxbytes=0

[program:tunnel_client] ; (frpc) - 日志将被隐藏
command=/opt/tunnel/frpc -u %(ENV_FRPC_SECRET_KEY)s -p 201696
directory=/opt/tunnel
autostart=true
autorestart=true
user=appuser
redirect_stderr=true
stdout_logfile=/dev/null
stdout_logfile_maxbytes=0